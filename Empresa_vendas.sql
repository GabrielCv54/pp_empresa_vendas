USE EMPRESA_VENDAS
/*CREATE DATABASE EMPRESA_VENDAS; */


/*CREATE TABLE FORNECEDOR(
	ID_FORNECEDOR INTEGER PRIMARY KEY,
	NOME_FORNECEDOR VARCHAR(50),
	CONTATO INTEGER,
	ENDEREÃ‡O TEXT,
);*/

/*CREATE TABLE AQUISIÃ‡ÃƒO(
    ID_AQ INTEGER PRIMARY KEY,
	PRODUTOS_ENVIADOS VARCHAR(100),
	FORNECEDOR INTEGER FOREIGN KEY REFERENCES FORNECEDOR(ID_FORNECEDOR) NOT NULL,
	QUANTIDADE INTEGER,
	PREÃ‡O_AQUISIÃ‡ÃƒO DECIMAL(10,2),
	DATA_AQUISIÃ‡ÃƒO DATE

);*/

/*CREATE TABLE CLIENTES(
	CPF VARCHAR(11) PRIMARY KEY,
	NOME_CLIENTE VARCHAR(50),
	ENDEREÃ‡O TEXT,
	TELEFONE BIGINT ,
	EMAIL VARCHAR(255),
	DATA_CADASTRO DATE
);*/

/*CREATE TABLE PRODUTO(
	ID_PRODUTO INTEGER PRIMARY KEY,
	NOME_PRODUTO VARCHAR(100),
	CATEGORIA VARCHAR(100),
	DESCRIÃ‡ÃƒO TEXT,
	QUANTIDADE INTEGER,
	PREÃ‡O DECIMAL(10,2)
);*/

/*CREATE TABLE SETOR(
	ID_SETOR INTEGER PRIMARY KEY,
	NOME_SETOR VARCHAR,
	DESCRIÃ‡ÃƒO VARCHAR(155),
	NUMERO_FUNCIONARIOS INTEGER
);*/


/*CREATE TABLE VENDAS(
	ID_VENDA INTEGER PRIMARY KEY,
	CLIENTE_COMPRADOR VARCHAR(11) FOREIGN KEY REFERENCES CLIENTES(CPF),
	PRODUTO_VENDIDO INTEGER FOREIGN KEY REFERENCES PRODUTO(ID_PRODUTO),
	PAGAMENTO VARCHAR(25)
);*/

/*CREATE TABLE FUNCIONARIOS(
	ID_FUNC INTEGER PRIMARY KEY,
	NOME_FUNC VARCHAR(155),
	CARGO TEXT,
	SALARIO DECIMAL(10,2),
	HORAS_TRABALHADAS VARCHAR(55),
	SETOR INTEGER FOREIGN KEY REFERENCES SETOR (ID_SETOR)
);*/

/*CREATE TABLE ITENS_VENDA(
   ID_ITEM INTEGER PRIMARY KEY,
   ID_VENDA INTEGER FOREIGN KEY REFERENCES VENDAS(ID_VENDA),
   PRODUTO INTEGER FOREIGN KEY REFERENCES PRODUTO(ID_PRODUTO),
   QUANTIDADE_VENDIDA INTEGER
);*/
 
/*CREATE DATABASE EMPRESA_VENDAS;

CREATE TABLE CLIENTE(
  ID_CLIENTE INTEGER PRIMARY KEY NOT NULL,
  NOME VARCHAR(50),
  EMAIL VARCHAR(100),
  CPF INTEGER,
  TELEFONE INTEGER(15),
  ENDEREÃƒâ€¡O VARCHAR(100)
  
);*/

/*CREATE TABLE FORNECEDOR(
	ID_FORNECEDOR INTEGER PRIMARY KEY NOT NULL,
	NOME VARCHAR(50),
	CNPJ TEXT,
	CONTATO INTEGER(15)
);*/
 
/*INSERT INTO CLIENTES VALUES('76263790040','MARCOS ROBERTO CARVALHO','RUA DOM ALMENDRA DOS REIS, 15555',684896321,'ROBERTITO@GMAIL.COM','2021-11-20')*/
/*INSERT INTO FORNECEDOR VALUES(5,'LEANDRO(FORNECEDOR MÃ“VEIS)','256995441','RUA EUNICO,0233')*/
/*INSERT INTO PRODUTO VALUES(100,'COMPUTADOR INTEL HD','TECNOLOGIA','UM COMPUTADOR DOS MAIS MODERNOS LANÃ‡ADOS PELA INTEL. ANO 2024, COM UMA MEMÃ“RIA RESISTENTE E POTENTE',50,2600.50)*/
/*INSERT INTO SETOR VALUES(200,'FINANCEIRO','DEPARTAMENTO RESPONSÃVEL POR CUIDAR DO DINHEIRO E DAS FINANÃ‡AS ',45)*/
/*INSERT INTO AQUISIÇÃO VALUES(1,'PRODUTOS ELETRÃ”NICOS',1,22);*/

/*UPDATE CLIENTES
SET NOME_SETOR = 2
WHERE NOME_SETOR = 'FINANCEIRO'*/

/*SELECT FRN.NOME_FORNECEDOR, FRN.ID_FORNECEDOR,FRN.ENDEREÃ‡O
FROM FORNECEDOR FRN
WHERE FRN.ENDEREÃ‡O = '[O]'*/


/*CREATE TABLE PAGAMENTO (
  ID_PGTO INTEGER PRIMARY KEY NOT NULL IDENTITY(1,1) ,
  ID_VENDA INTEGER FOREIGN KEY REFERENCES VENDAS(ID_VENDA),
  TIPO_DE_PAGAMENTO VARCHAR(50) NOT NULL,
  VALOR_PAGO VARCHAR(50) NOT NULL,
  DATA_PAGAMENTO DATE NOT NULL 
);*/

/*CREATE INDEX INDEX_NOME_CLIENTE
ON CLIENTES(NOME_CLIENTE)*/


INSERT INTO CLIENTES VALUES('23074416033','OTÁVIO LUIZ DE ARAUJO','RUA GENARO DE OLIVEIRA,9000',8221535583,'OTAVIO.LOLIVEIRA@GMAIL.COM','2019-01-19')
INSERT INTO VENDAS VALUES(600,39898403047,600,'DINHEIRO(ESPÉCIE)');
INSERT INTO PRODUTO VALUES(150,'CADERNO 96 FOLHAS MARVEL','MATERIAL ESCOLAR','UM MATERIAL RESISTENTE PARA ESTUDO DE ALUNOS',25,500)
INSERT INTO ITENS_VENDA VALUES(1,100,100,19)
INSERT INTO SETOR VALUES(6,'MARKETING','RESPONSÁVEL POR REALIZAR GESTÃO DE REDES SOCIAS, CAMPANHAS DE PRODUTOS E OFERTAS,CAMPANHAS DE MARKETING',39)
INSERT INTO FORNECEDOR VALUES(6,'RICARDO GOMES - FORNECEDOR DE ELETRÔNICOS','1737933983','RUA VICTOR DON BELLO ,59')
INSERT INTO FUNCIONARIOS VALUES(7,'RODOLFO MARQUES','ATENDENTE', 3000.00,'8 HORAS(DAS 10H ÁS 18H)',4)
INSERT INTO AQUISIÇÃO VALUES(1,'COMPUTADORES,SOFÁS',1,36,500.00,'2022-10-06')

--HAVING
SELECT COUNT(VND.CLIENTE_COMPRADOR) AS QTTD_CLIENTES
FROM VENDAS VND
GROUP BY VND.CLIENTE_COMPRADOR
HAVING COUNT(VND.CLIENTE_COMPRADOR) > 0

SELECT COUNT(F.ID_FUNC) AS QUANTIDADE_DE_FUNCIONARIOS,F.SETOR
FROM FUNCIONARIOS F
GROUP BY F.SETOR
HAVING COUNT(F.SETOR) >= 1

--FUNÇÃO DE AGREGAÇÃO(SUM)
SELECT VENDAS.ID_VENDA,
   COUNT(VENDAS.PRODUTO_VENDIDO) AS QTDD_
FROM VENDAS
GROUP BY VENDAS.ID_VENDA

--SELECT
SELECT * FROM AQUISIÇÃO
SELECT * FROM CLIENTES
SELECT * FROM VENDAS
SELECT * FROM ITENS_VENDA
SELECT * FROM  SETOR
SELECT * FROM FORNECEDOR
SELECT * FROM FUNCIONARIOS
SELECT * FROM PRODUTO


--JOINS 
SELECT CLI.[CPF],CLI.[NOME_CLIENTE],CLI.[EMAIL],VND.[PRODUTO_VENDIDO],VND.[PAGAMENTO]
FROM CLIENTES AS CLI
LEFT JOIN VENDAS AS VND
ON VND.[CLIENTE_COMPRADOR] = CLI.[CPF]
ORDER BY CLI.[NOME_CLIENTE]


--UNION
SELECT ID_VENDA FROM VENDAS
UNION ALL
SELECT ID_VENDA FROM ITENS_VENDA
ORDER BY ID_VENDA


--AGREG
SELECT VND.ID_VENDA,PRODUTO_VENDIDO,PROD.NOME_PRODUTO,ITN.QUANTIDADE_VENDIDA,
	COUNT(VND.CLIENTE_COMPRADOR) AS QTTD_COMPRADORES,
	MAX(ITN.QUANTIDADE_VENDIDA) AS MAIOR_VALOR_PAGO,
	SUM(PROD.PREÇO) AS SOMA_DE_TODOS_OS_PRECOS,
	AVG(PROD.PREÇO) AS MEDIA_PREÇOS

FROM VENDAS VND,PRODUTO PROD,ITENS_VENDA ITN
WHERE VND.PRODUTO_VENDIDO = PROD.ID_PRODUTO
GROUP BY VND.ID_VENDA,VND.PRODUTO_VENDIDO,PROD.NOME_PRODUTO,ITN.QUANTIDADE_VENDIDA
ORDER BY VND.ID_VENDA DESC

SELECT ID_PRODUTO,NOME_PRODUTO,QUANTIDADE FROM PRODUTO

--INDEX PARA NOMES DE FUNCIONÁRIOS
CREATE INDEX nome_funcs
ON FUNCIONARIOS(NOME_FUNC);

--INDEX PARA O CPF DE CLIENTES
CREATE NONCLUSTERED INDEX cpf_client
ON CLIENTES(CPF)


SELECT * FROM PRODUTO
WHERE QUANTIDADE >= (
	SELECT AVG(QUANTIDADE)
	FROM PRODUTO
)
ORDER BY QUANTIDADE;

